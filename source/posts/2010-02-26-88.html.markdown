---
title: "在FreeBSD上寫masm"
date: 2010-02-26 00:53:50 +0800
comments: true
categories: FreeBSD
---
<p>系上要用masm交作業，然而我的系統是FreeBSD，由於不想灌windows，而有了這個替代方案...</p><p>先看看組語言到底有哪些種類</p><table id="sortable_table_id_0" class="wikitable sortable" style="font-size: 85%; text-align: center; width: 500px; height: 386px;"><tbody><tr><th><a href="http://zh.wikipedia.org/zh-tw/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80" title="彙編語言">彙編語言</a>&nbsp;&nbsp;<a href="http://zh.wikipedia.org/zh-tw/%E7%B5%84%E5%90%88%E8%AA%9E%E8%A8%80%E5%88%97%E8%A1%A8#" class="sortheader" onclick="ts_resortTable(this);return false;"><span class="sortarrow">&nbsp;</span></a></th><th><a href="http://zh.wikipedia.org/zh-tw/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F" title="作業系統">OS</a>&nbsp;&nbsp;<a href="http://zh.wikipedia.org/zh-tw/%E7%B5%84%E5%90%88%E8%AA%9E%E8%A8%80%E5%88%97%E8%A1%A8#" class="sortheader" onclick="ts_resortTable(this);return false;"><span class="sortarrow">&nbsp;</span></a></th><th><a href="http://zh.wikipedia.org/zh-tw/%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81" title="開放原始碼">開放原始碼</a>&nbsp;&nbsp;<a href="http://zh.wikipedia.org/zh-tw/%E7%B5%84%E5%90%88%E8%AA%9E%E8%A8%80%E5%88%97%E8%A1%A8#" class="sortheader" onclick="ts_resortTable(this);return false;"><span class="sortarrow">&nbsp;</span></a></th><th><a href="http://zh.wikipedia.org/zh-tw/%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF%E8%AF%81" title="軟體許可證">許可證</a>&nbsp;&nbsp;<a href="http://zh.wikipedia.org/zh-tw/%E7%B5%84%E5%90%88%E8%AA%9E%E8%A8%80%E5%88%97%E8%A1%A8#" class="sortheader" onclick="ts_resortTable(this);return false;"><span class="sortarrow">&nbsp;</span></a></th><th><a href="http://zh.wikipedia.org/zh-tw/X86-64" title="X86-64">x86-64</a>&nbsp;&nbsp;<a href="http://zh.wikipedia.org/zh-tw/%E7%B5%84%E5%90%88%E8%AA%9E%E8%A8%80%E5%88%97%E8%A1%A8#" class="sortheader" onclick="ts_resortTable(this);return false;"><span class="sortarrow"></span></a></th><th>積極開發&nbsp;&nbsp;<a href="http://zh.wikipedia.org/zh-tw/%E7%B5%84%E5%90%88%E8%AA%9E%E8%A8%80%E5%88%97%E8%A1%A8#" class="sortheader" onclick="ts_resortTable(this);return false;"><span class="sortarrow"></span></a></th></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=A86_%28software%29&amp;action=edit&amp;redlink=1" class="new" title="A86 (software) （頁面未存在）">A86/A386</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><a href="http://zh.wikipedia.org/zh-tw/%E4%B8%93%E6%9C%89%E8%BD%AF%E4%BB%B6" title="專有軟體">專有軟體</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td></tr><tr><th><a href="http://www.develsoftware.com/index.php/en/download" class="external text" rel="nofollow">DevelSoftware Assembler</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/Linux" title="Linux">Linux</a>, <a href="http://zh.wikipedia.org/zh-tw/Unix-like" title="Unix-like" class="mw-redirect">Unix-like</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><a href="http://zh.wikipedia.org/zh-tw/%E5%85%8D%E8%B4%B9%E8%BD%AF%E4%BB%B6" title="免費軟體" class="mw-redirect">免費軟體</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=FASM&amp;action=edit&amp;redlink=1" class="new" title="FASM （頁面未存在）">FASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a>, <a href="http://zh.wikipedia.org/zh-tw/Linux" title="Linux">Linux</a>, <a href="http://zh.wikipedia.org/zh-tw/Unix-like" title="Unix-like" class="mw-redirect">Unix-like</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td><a href="http://zh.wikipedia.org/zh-tw/BSD%E8%AE%B8%E5%8F%AF%E8%AF%81" title="BSD許可證">BSD許可證</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=GNU_Assembler&amp;action=edit&amp;redlink=1" class="new" title="GNU Assembler （頁面未存在）">GAS</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Unix-like" title="Unix-like" class="mw-redirect">Unix-like</a>, <a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td><a href="http://zh.wikipedia.org/zh-tw/GNU%E9%80%9A%E7%94%A8%E5%85%AC%E5%85%B1%E8%AE%B8%E5%8F%AF%E8%AF%81" title="GNU通用公共許可證">GNU通用公共許可證</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://www.jorgon.freeserve.co.uk/" class="external text" rel="nofollow">GoAsm</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><a href="http://zh.wikipedia.org/zh-tw/%E5%85%8D%E8%B4%B9%E8%BD%AF%E4%BB%B6" title="免費軟體" class="mw-redirect">免費軟體</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=High_Level_Assembly&amp;action=edit&amp;redlink=1" class="new" title="High Level Assembly （頁面未存在）">HLA</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/Linux" title="Linux">Linux</a>, <a href="http://zh.wikipedia.org/zh-tw/FreeBSD" title="FreeBSD">FreeBSD</a>, <a href="http://zh.wikipedia.org/zh-tw/Mac_OS_X" title="Mac OS X">Mac OS X</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td><a href="http://zh.wikipedia.org/zh-tw/%E5%85%AC%E6%9C%89%E9%A2%86%E5%9F%9F" title="公有領域">公有領域</a></td><td><i><b>?</b></i></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://www.japheth.de/JWasm.html" class="external text" rel="nofollow">JWASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td>Sybase 開放公共許可證 <a href="http://zh.wikipedia.org/w/index.php?title=Watcom&amp;action=edit&amp;redlink=1" class="new" title="Watcom （頁面未存在）">Watcom</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://lzasm.hotbox.ru/" class="external text" rel="nofollow">LZASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><a href="http://zh.wikipedia.org/zh-tw/%E5%85%8D%E8%B4%B9%E8%BD%AF%E4%BB%B6" title="免費軟體" class="mw-redirect">免費軟體</a></td><td><i><b>?</b></i></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://zh.wikipedia.org/zh-tw/MASM" title="MASM">MASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><a href="http://zh.wikipedia.org/zh-tw/%E4%B8%93%E6%9C%89%E8%BD%AF%E4%BB%B6" title="專有軟體">專有軟體</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是<span class="reference plainlinksneverexpand" id="ref_MASM"></span></td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=Netwide_Assembler&amp;action=edit&amp;redlink=1" class="new" title="Netwide Assembler （頁面未存在）">NASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/Linux" title="Linux">Linux</a>, <a href="http://zh.wikipedia.org/zh-tw/Mac_OS_X" title="Mac OS X">Mac OS X</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a>, <a href="http://zh.wikipedia.org/zh-tw/OS/2" title="OS/2">OS/2</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td><a href="http://zh.wikipedia.org/zh-tw/BSD%E8%AE%B8%E5%8F%AF%E8%AF%81" title="BSD許可證">BSD許可證</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=POASM&amp;action=edit&amp;redlink=1" class="new" title="POASM （頁面未存在）">POASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/Windows_Mobile" title="Windows Mobile">Windows Mobile</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><a href="http://zh.wikipedia.org/zh-tw/%E5%85%8D%E8%B4%B9%E8%BD%AF%E4%BB%B6" title="免費軟體" class="mw-redirect">免費軟體</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=TASM&amp;action=edit&amp;redlink=1" class="new" title="TASM （頁面未存在）">TASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><a href="http://zh.wikipedia.org/zh-tw/%E4%B8%93%E6%9C%89%E8%BD%AF%E4%BB%B6" title="專有軟體">專有軟體</a></td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><i><b>?</b></i><span class="reference plainlinksneverexpand" id="ref_TASM"></span></td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=WASM_%28software%29&amp;action=edit&amp;redlink=1" class="new" title="WASM (software) （頁面未存在）">WASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a>, <a href="http://zh.wikipedia.org/zh-tw/OS/2" title="OS/2">OS/2</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td>Sybase Open <a href="http://zh.wikipedia.org/w/index.php?title=Watcom&amp;action=edit&amp;redlink=1" class="new" title="Watcom （頁面未存在）">Watcom</a> Public License</td><td style="background: #ff9090 none repeat scroll 0% 0%; color: black;" class="table-no">否</td><td><i><b>?</b></i></td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=Tiny_C_Compiler&amp;action=edit&amp;redlink=1" class="new" title="Tiny C Compiler （頁面未存在）">TCCASM</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Unix-like" title="Unix-like" class="mw-redirect">Unix-like</a>, <a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td><a href="http://zh.wikipedia.org/zh-tw/LGPL" title="LGPL" class="mw-redirect">LGPL</a></td><td><i><b>?</b></i></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr><tr><th><a href="http://zh.wikipedia.org/w/index.php?title=Yasm&amp;action=edit&amp;redlink=1" class="new" title="Yasm （頁面未存在）">Yasm</a></th><td><a href="http://zh.wikipedia.org/zh-tw/Microsoft_Windows" title="Microsoft Windows">Windows</a>, <a href="http://zh.wikipedia.org/zh-tw/DOS" title="DOS">DOS</a>, <a href="http://zh.wikipedia.org/zh-tw/Linux" title="Linux">Linux</a>, <a href="http://zh.wikipedia.org/zh-tw/Mac_OS_X" title="Mac OS X">Mac OS X</a>, <a href="http://zh.wikipedia.org/zh-tw/Unix-like" title="Unix-like" class="mw-redirect">Unix-like</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td><a href="http://zh.wikipedia.org/zh-tw/BSD_licenses" title="BSD licenses" class="mw-redirect">BSD</a></td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td><td style="background: #90ff90 none repeat scroll 0% 0%; color: black;" class="table-yes">是</td></tr></tbody></table><p>（唯一一個有標注FreeBSD的是HLA...QQ）</p><p>%portinstall -c emulators/dosbox</p><p>%rehash</p><p>%mkdir ~/learnASM</p><p>%mkdir ~/learnASM/tools</p><p>%mkdir ~/learnASM/tools/masm5</p><p>從網路上下載masm5.0(太新的版本可能不能跑)</p><p>我是從<a href="http://download.pchome.net/development/linetools/detail-9028.html">這裡</a>下載的</p><p>把含有.exe檔的目錄下所有的檔案放在~/learnASM/tools/masm5</p><p>%cd ~/learnASM</p><p>%echo "dosbox -c 'mount c: ./' -c 'path %path%;c:\tools;c:\tools\masm5'" &gt; runDosbox.sh </p><p>%chmod +x runDosbox.sh</p><p>%./runDosbox.sh</p><p>到目前為止dosbox已經具備組譯的能力，至於怎麼使用masm...</p><p>首先要有一個.asm原碼，這裡用hello.asm，我是先用vim或vi在learnASM/編輯，然後對著dosbox按Ctrl+F4重新整理，不然新增的檔案dosbox會找不到。</p><p>---hello.asm---</p><p>&nbsp;&nbsp; .model small<br />&nbsp;&nbsp; .stack<br />&nbsp;&nbsp; .data<br />&nbsp;&nbsp; message&nbsp;&nbsp; db "Hello world, I'm learning Assembly !!!", "$" <br />&nbsp;&nbsp; <br />&nbsp;&nbsp; .code<br />&nbsp;&nbsp; <br />&nbsp;&nbsp; main&nbsp;&nbsp; proc<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp; ax,seg message<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp; ds,ax<br />&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp; ah,09<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lea&nbsp;&nbsp; dx,message<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp; 21h <br />&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp; ax,4c00h<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp; 21h <br />&nbsp;&nbsp; main&nbsp;&nbsp; endp</p><p>&nbsp;&nbsp; end main</p><p>---hello.asm---</p><p>進入dosbox之後</p><p>&gt;c:</p><p>&gt;masm hello.asm&nbsp; //之後按三次回車</p><p>Object filename [HELLO.OBJ]:</p><p>Source listing [NUL.LST]:</p><p>Cross-reference [NUL.CRF]:</p><p>這時會產生一個 HELLO.OBJ檔案</p><p>&gt;link HELLO.OBJ&nbsp; //按三次回車</p><p>Run File [HELLO.EXE]:</p><p>List File [NUL.MAP]:</p><p>Libraries [.LIB]:</p><p>&gt;HELLO.EXE</p><p>Hello world, I'm learning Assembly !!!</p><p>成功^^</p><p>&nbsp;</p><p>ps.</p><p>每次要組譯都要打兩行指令，按六次回車不免太麻煩</p><p>於是可以寫一個mk.bat放在toos/masm/裡面</p><p>---mk.bat---</p><p>masm.exe %1.asm,%1.obj,nul.lst,nul.crf</p><p>link %1.obj,%1.exe,nul.map,, </p><p>---mk.bat---</p><p>以後只要輸入下面指令就好了</p><p>&gt;mk hello //不要加副檔名</p><p>&nbsp;</p>
